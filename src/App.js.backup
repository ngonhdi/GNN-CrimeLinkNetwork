import React, { useState, useEffect, useRef } from "react";

// Mock data for Chicago crime network
const mockCrimes = [
  {
    id: "CR-2024-001",
    type: "MOTOR VEHICLE THEFT",
    lat: 41.8781,
    lng: -87.6298,
    date: "2024-01-15",
    time: "02:30",
    district: 7,
    arrested: false,
  },
  {
    id: "CR-2024-002",
    type: "MOTOR VEHICLE THEFT",
    lat: 41.8812,
    lng: -87.6245,
    date: "2024-01-14",
    time: "03:15",
    district: 7,
    arrested: false,
  },
  {
    id: "CR-2024-003",
    type: "MOTOR VEHICLE THEFT",
    lat: 41.8756,
    lng: -87.6312,
    date: "2024-01-13",
    time: "02:45",
    district: 8,
    arrested: true,
  },
  {
    id: "CR-2024-004",
    type: "BURGLARY",
    lat: 41.8834,
    lng: -87.6289,
    date: "2024-01-15",
    time: "04:00",
    district: 7,
    arrested: false,
  },
  {
    id: "CR-2024-005",
    type: "NARCOTICS",
    lat: 41.8901,
    lng: -87.6456,
    date: "2024-01-16",
    time: "22:30",
    district: 11,
    arrested: true,
  },
];

const relatedCrimes = [
  {
    id: "CR-2024-002",
    similarity: 0.92,
    spatialWeight: 0.85,
    temporalWeight: 0.78,
    semanticWeight: 0.95,
  },
  {
    id: "CR-2024-003",
    similarity: 0.87,
    spatialWeight: 0.72,
    temporalWeight: 0.65,
    semanticWeight: 0.91,
  },
  {
    id: "CR-2024-004",
    similarity: 0.86,
    spatialWeight: 0.88,
    temporalWeight: 0.82,
    semanticWeight: 0.45,
  },
];

// Animated scanning effect component
const ScanningOverlay = ({ isScanning, progress }) => {
  if (!isScanning) return null;
  return (
    <div className="scanning-overlay">
      <div
        className="scan-ring"
        style={{
          transform: `scale(${1 + progress * 0.5})`,
          opacity: 1 - progress * 0.3,
        }}
      />
      <div
        className="scan-ring delay"
        style={{
          transform: `scale(${1 + progress * 0.3})`,
          opacity: 1 - progress * 0.5,
        }}
      />
      <div className="scan-text">
        {progress < 0.33 && "Analyzing Spatial proximity..."}
        {progress >= 0.33 &&
          progress < 0.66 &&
          "Analyzing Temporal patterns..."}
        {progress >= 0.66 && "Detected semantic match..."}
      </div>
    </div>
  );
};

// Network Graph Visualization
const NetworkGraph = ({ nodes, edges, highlightedNodes, onNodeClick }) => {
  const svgRef = useRef(null);
  const [positions, setPositions] = useState([]);

  useEffect(() => {
    // Generate node positions in a force-directed layout simulation
    const centerX = 300;
    const centerY = 200;
    const newPositions = nodes.map((node, i) => ({
      ...node,
      x:
        centerX +
        Math.cos((i / nodes.length) * Math.PI * 2) * (100 + Math.random() * 80),
      y:
        centerY +
        Math.sin((i / nodes.length) * Math.PI * 2) * (80 + Math.random() * 60),
    }));
    setPositions(newPositions);
  }, [nodes]);

  return (
    <svg ref={svgRef} viewBox="0 0 600 400" className="network-graph">
      <defs>
        <filter id="glow">
          <feGaussianBlur stdDeviation="3" result="coloredBlur" />
          <feMerge>
            <feMergeNode in="coloredBlur" />
            <feMergeNode in="SourceGraphic" />
          </feMerge>
        </filter>
        <linearGradient id="edgeGradient" x1="0%" y1="0%" x2="100%" y2="0%">
          <stop offset="0%" stopColor="#00f5d4" stopOpacity="0.2" />
          <stop offset="50%" stopColor="#00f5d4" stopOpacity="0.8" />
          <stop offset="100%" stopColor="#00f5d4" stopOpacity="0.2" />
        </linearGradient>
      </defs>

      {/* Edges */}
      {edges.map((edge, i) => {
        const source = positions.find((p) => p.id === edge.source);
        const target = positions.find((p) => p.id === edge.target);
        if (!source || !target) return null;
        const isHighlighted =
          highlightedNodes.includes(edge.source) &&
          highlightedNodes.includes(edge.target);
        return (
          <g key={i}>
            <line
              x1={source.x}
              y1={source.y}
              x2={target.x}
              y2={target.y}
              stroke={isHighlighted ? "#00f5d4" : "#2a3a4a"}
              strokeWidth={isHighlighted ? 2 : 1}
              opacity={isHighlighted ? 1 : 0.3}
              className={isHighlighted ? "edge-animated" : ""}
            />
            {isHighlighted && (
              <circle r="3" fill="#00f5d4" filter="url(#glow)">
                <animateMotion
                  dur="1.5s"
                  repeatCount="indefinite"
                  path={`M${source.x},${source.y} L${target.x},${target.y}`}
                />
              </circle>
            )}
          </g>
        );
      })}

      {/* Nodes */}
      {positions.map((node, i) => {
        const isHighlighted = highlightedNodes.includes(node.id);
        const nodeColor =
          node.type === "MOTOR VEHICLE THEFT"
            ? "#ff6b6b"
            : node.type === "NARCOTICS"
            ? "#9b59b6"
            : node.type === "BURGLARY"
            ? "#f39c12"
            : "#3498db";
        return (
          <g
            key={node.id}
            onClick={() => onNodeClick(node)}
            style={{ cursor: "pointer" }}
          >
            {isHighlighted && (
              <circle
                cx={node.x}
                cy={node.y}
                r="20"
                fill="none"
                stroke="#00f5d4"
                strokeWidth="2"
                opacity="0.5"
                className="pulse-ring"
              />
            )}
            <circle
              cx={node.x}
              cy={node.y}
              r={isHighlighted ? 12 : 8}
              fill={nodeColor}
              filter={isHighlighted ? "url(#glow)" : ""}
              className={isHighlighted ? "node-highlighted" : ""}
            />
            {isHighlighted && (
              <text
                x={node.x}
                y={node.y - 20}
                textAnchor="middle"
                fill="#fff"
                fontSize="10"
              >
                {node.id}
              </text>
            )}
          </g>
        );
      })}
    </svg>
  );
};

// Radar Chart for profiling
const RadarChart = ({ data, labels }) => {
  const centerX = 150;
  const centerY = 150;
  const radius = 100;
  const angleStep = (Math.PI * 2) / labels.length;

  const getPoint = (value, index) => {
    const angle = index * angleStep - Math.PI / 2;
    return {
      x: centerX + Math.cos(angle) * radius * value,
      y: centerY + Math.sin(angle) * radius * value,
    };
  };

  const cityAvgPath =
    data.cityAvg
      .map((v, i) => getPoint(v, i))
      .map((p, i) => `${i === 0 ? "M" : "L"}${p.x},${p.y}`)
      .join(" ") + "Z";
  const groupPath =
    data.group
      .map((v, i) => getPoint(v, i))
      .map((p, i) => `${i === 0 ? "M" : "L"}${p.x},${p.y}`)
      .join(" ") + "Z";

  return (
    <svg viewBox="0 0 300 300" className="radar-chart">
      {/* Grid circles */}
      {[0.25, 0.5, 0.75, 1].map((scale) => (
        <circle
          key={scale}
          cx={centerX}
          cy={centerY}
          r={radius * scale}
          fill="none"
          stroke="#2a3a4a"
          strokeWidth="1"
        />
      ))}

      {/* Grid lines */}
      {labels.map((_, i) => {
        const point = getPoint(1, i);
        return (
          <line
            key={i}
            x1={centerX}
            y1={centerY}
            x2={point.x}
            y2={point.y}
            stroke="#2a3a4a"
            strokeWidth="1"
          />
        );
      })}

      {/* City average */}
      <path
        d={cityAvgPath}
        fill="rgba(52, 152, 219, 0.2)"
        stroke="#3498db"
        strokeWidth="2"
      />

      {/* Group data */}
      <path
        d={groupPath}
        fill="rgba(0, 245, 212, 0.3)"
        stroke="#00f5d4"
        strokeWidth="2"
      />

      {/* Labels */}
      {labels.map((label, i) => {
        const point = getPoint(1.2, i);
        return (
          <text
            key={i}
            x={point.x}
            y={point.y}
            textAnchor="middle"
            fill="#8899aa"
            fontSize="10"
          >
            {label}
          </text>
        );
      })}
    </svg>
  );
};

// Heatmap component
const HeatmapVisualization = ({ timeStep, timeFilter, crimeType }) => {
  // Different hotspot configurations based on filters
  const hotspotConfigs = {
    weekend: {
      narcotics: [
        { x: 120, y: 80, intensity: 0.9, shifting: true },
        { x: 280, y: 150, intensity: 0.7, shifting: false },
        { x: 200, y: 220, intensity: 0.8, shifting: true },
      ],
      theft: [
        { x: 350, y: 100, intensity: 0.85, shifting: true },
        { x: 150, y: 180, intensity: 0.75, shifting: true },
        { x: 400, y: 200, intensity: 0.6, shifting: false },
      ],
      violence: [
        { x: 180, y: 120, intensity: 0.95, shifting: true },
        { x: 320, y: 180, intensity: 0.8, shifting: true },
      ],
      all: [
        { x: 120, y: 80, intensity: 0.9, shifting: true },
        { x: 280, y: 150, intensity: 0.7, shifting: false },
        { x: 200, y: 220, intensity: 0.8, shifting: true },
        { x: 350, y: 100, intensity: 0.6, shifting: true },
        { x: 150, y: 180, intensity: 0.5, shifting: false },
      ],
    },
    weekday: {
      narcotics: [
        { x: 200, y: 100, intensity: 0.6, shifting: false },
        { x: 300, y: 200, intensity: 0.5, shifting: true },
      ],
      theft: [
        { x: 250, y: 80, intensity: 0.8, shifting: true },
        { x: 180, y: 200, intensity: 0.7, shifting: true },
        { x: 380, y: 150, intensity: 0.65, shifting: false },
      ],
      violence: [
        { x: 150, y: 150, intensity: 0.7, shifting: true },
        { x: 350, y: 120, intensity: 0.6, shifting: false },
      ],
      all: [
        { x: 200, y: 100, intensity: 0.6, shifting: false },
        { x: 300, y: 200, intensity: 0.5, shifting: true },
        { x: 250, y: 80, intensity: 0.7, shifting: true },
      ],
    },
    night: {
      narcotics: [
        { x: 100, y: 100, intensity: 0.95, shifting: true },
        { x: 250, y: 180, intensity: 0.85, shifting: true },
        { x: 380, y: 80, intensity: 0.9, shifting: true },
      ],
      theft: [
        { x: 150, y: 120, intensity: 0.7, shifting: true },
        { x: 320, y: 200, intensity: 0.6, shifting: false },
      ],
      violence: [
        { x: 200, y: 100, intensity: 0.98, shifting: true },
        { x: 300, y: 180, intensity: 0.92, shifting: true },
        { x: 400, y: 120, intensity: 0.88, shifting: true },
      ],
      all: [
        { x: 100, y: 100, intensity: 0.95, shifting: true },
        { x: 250, y: 180, intensity: 0.85, shifting: true },
        { x: 380, y: 80, intensity: 0.9, shifting: true },
        { x: 200, y: 150, intensity: 0.75, shifting: false },
      ],
    },
  };

  const hotspots =
    hotspotConfigs[timeFilter]?.[crimeType] || hotspotConfigs.weekend.all;

  return (
    <svg viewBox="0 0 500 300" className="heatmap-svg">
      <defs>
        <radialGradient id="hotspot1">
          <stop offset="0%" stopColor="#ff0000" stopOpacity="0.8" />
          <stop offset="50%" stopColor="#ff6b00" stopOpacity="0.4" />
          <stop offset="100%" stopColor="#ff6b00" stopOpacity="0" />
        </radialGradient>
        <radialGradient id="hotspot2">
          <stop offset="0%" stopColor="#ff6b00" stopOpacity="0.6" />
          <stop offset="50%" stopColor="#ffaa00" stopOpacity="0.3" />
          <stop offset="100%" stopColor="#ffaa00" stopOpacity="0" />
        </radialGradient>
        <marker
          id="arrowhead"
          markerWidth="10"
          markerHeight="7"
          refX="9"
          refY="3.5"
          orient="auto"
        >
          <polygon points="0 0, 10 3.5, 0 7" fill="#00f5d4" />
        </marker>
      </defs>

      {/* Background grid */}
      <rect width="500" height="300" fill="#0a0f14" />
      {[...Array(10)].map((_, i) => (
        <line
          key={`h${i}`}
          x1="0"
          y1={i * 30}
          x2="500"
          y2={i * 30}
          stroke="#1a2530"
          strokeWidth="1"
        />
      ))}
      {[...Array(17)].map((_, i) => (
        <line
          key={`v${i}`}
          x1={i * 30}
          y1="0"
          x2={i * 30}
          y2="300"
          stroke="#1a2530"
          strokeWidth="1"
        />
      ))}

      {/* Hotspots */}
      {hotspots.map((spot, i) => {
        const shiftX = spot.shifting ? Math.sin(timeStep * 0.5) * 20 : 0;
        const shiftY = spot.shifting ? Math.cos(timeStep * 0.3) * 15 : 0;
        return (
          <circle
            key={i}
            cx={spot.x + shiftX}
            cy={spot.y + shiftY}
            r={50 * spot.intensity}
            fill={`url(#hotspot${spot.intensity > 0.7 ? "1" : "2"})`}
            className="hotspot-pulse"
          />
        );
      })}

      {/* Movement arrows */}
      {timeStep > 2 && (
        <>
          <path
            d="M 130,90 Q 160,120 190,140"
            fill="none"
            stroke="#00f5d4"
            strokeWidth="2"
            markerEnd="url(#arrowhead)"
            className="arrow-animate"
          />
          <path
            d="M 360,110 Q 340,150 300,170"
            fill="none"
            stroke="#00f5d4"
            strokeWidth="2"
            markerEnd="url(#arrowhead)"
            className="arrow-animate"
          />
        </>
      )}

      {/* High-risk zone markers */}
      {timeStep > 3 && (
        <>
          <rect
            x="240"
            y="160"
            width="60"
            height="40"
            fill="none"
            stroke="#ff0000"
            strokeWidth="2"
            strokeDasharray="5,5"
            className="zone-blink"
          />
          <text
            x="270"
            y="155"
            textAnchor="middle"
            fill="#ff0000"
            fontSize="10"
          >
            HIGH RISK
          </text>
          <rect
            x="100"
            y="200"
            width="50"
            height="35"
            fill="none"
            stroke="#ff0000"
            strokeWidth="2"
            strokeDasharray="5,5"
            className="zone-blink"
          />
          <text
            x="125"
            y="195"
            textAnchor="middle"
            fill="#ff0000"
            fontSize="10"
          >
            HIGH RISK
          </text>
        </>
      )}
    </svg>
  );
};

// Main CrimeLink Dashboard
export default function CrimeLinkDashboard() {
  const [activeTab, setActiveTab] = useState("investigate");
  const [selectedCrime, setSelectedCrime] = useState(null);
  const [isScanning, setIsScanning] = useState(false);
  const [scanProgress, setScanProgress] = useState(0);
  const [showResults, setShowResults] = useState(false);
  const [highlightedNodes, setHighlightedNodes] = useState([]);
  const [timeSlider, setTimeSlider] = useState(0);
  const [selectedCluster, setSelectedCluster] = useState(null);
  const [showExplanation, setShowExplanation] = useState(false);

  // Forecast tab filters
  const [timeFilter, setTimeFilter] = useState("weekend");
  const [crimeTypeFilter, setCrimeTypeFilter] = useState("narcotics");

  // Animation states
  const [isForecasting, setIsForecasting] = useState(false);
  const [forecastComplete, setForecastComplete] = useState(false);

  // Graph data
  const graphNodes = mockCrimes.map((c) => ({
    id: c.id,
    type: c.type,
    lat: c.lat,
    lng: c.lng,
  }));
  const graphEdges = [
    { source: "CR-2024-001", target: "CR-2024-002", type: "spatial" },
    { source: "CR-2024-001", target: "CR-2024-003", type: "semantic" },
    { source: "CR-2024-001", target: "CR-2024-004", type: "temporal" },
    { source: "CR-2024-002", target: "CR-2024-003", type: "semantic" },
    { source: "CR-2024-002", target: "CR-2024-004", type: "spatial" },
    { source: "CR-2024-003", target: "CR-2024-004", type: "temporal" },
    { source: "CR-2024-005", target: "CR-2024-004", type: "spatial" },
  ];

  // Simulate scanning process
  const handleScan = () => {
    if (!selectedCrime) return;
    setIsScanning(true);
    setScanProgress(0);
    setShowResults(false);
    setHighlightedNodes([selectedCrime.id]);

    const interval = setInterval(() => {
      setScanProgress((prev) => {
        if (prev >= 1) {
          clearInterval(interval);
          setIsScanning(false);
          setShowResults(true);
          setHighlightedNodes([
            "CR-2024-001",
            "CR-2024-002",
            "CR-2024-003",
            "CR-2024-004",
          ]);
          return 1;
        }
        return prev + 0.02;
      });
    }, 50);
  };

  // Radar chart data for profiling - dynamic based on cluster
  const radarDataByCluster = {
    A: {
      cityAvg: [0.5, 0.6, 0.4, 0.5, 0.55, 0.45],
      group: [0.9, 0.3, 0.85, 0.7, 0.2, 0.95],
      name: "Trộm xe",
      temporalWeight: 0.7,
      spatialWeight: 0.3,
      peakTime: "2h-4h sáng",
      location: "ngõ cụt và khu vực kém chiếu sáng",
      insight:
        "Nhóm này hoạt động chủ yếu vào khung giờ khuya, nhắm vào các khu vực ít người qua lại. Tính lưu động cao cho thấy đây là nhóm chuyên nghiệp.",
    },
    B: {
      cityAvg: [0.5, 0.6, 0.4, 0.5, 0.55, 0.45],
      group: [0.75, 0.8, 0.4, 0.9, 0.7, 0.3],
      name: "Ma túy",
      temporalWeight: 0.4,
      spatialWeight: 0.6,
      peakTime: "20h-23h",
      location: "khu dân cư đông đúc và gần trường học",
      insight:
        "Hoạt động tập trung theo địa bàn cố định. Yếu tố không gian quan trọng hơn thời gian, cho thấy đây là mạng lưới phân phối địa phương.",
    },
    C: {
      cityAvg: [0.5, 0.6, 0.4, 0.5, 0.55, 0.45],
      group: [0.6, 0.9, 0.7, 0.5, 0.8, 0.4],
      name: "Đột nhập",
      temporalWeight: 0.55,
      spatialWeight: 0.45,
      peakTime: "10h-14h (giờ làm việc)",
      location: "khu dân cư cao cấp",
      insight:
        "Nhóm này hoạt động ban ngày khi gia chủ đi làm. Cân bằng giữa yếu tố thời gian và không gian cho thấy họ khảo sát kỹ trước khi hành động.",
    },
  };

  const currentRadarData = selectedCluster
    ? radarDataByCluster[selectedCluster]
    : null;
  const radarLabels = [
    "2-4 AM",
    "Residential",
    "Dead-ends",
    "Repeat",
    "Weekday",
    "Mobile",
  ];

  return (
    <div className="dashboard">
      <style>{`
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600;700&family=Sora:wght@300;400;500;600;700&display=swap');
        
        * {
          margin: 0;
          padding: 0;
          box-sizing: border-box;
        }
        
        .dashboard {
          min-height: 100vh;
          background: linear-gradient(135deg, #0a0f14 0%, #1a1f2e 50%, #0d1117 100%);
          color: #e0e6ed;
          font-family: 'Sora', sans-serif;
          overflow-x: hidden;
        }
        
        /* Header */
        .header {
          padding: 20px 40px;
          display: flex;
          justify-content: space-between;
          align-items: center;
          border-bottom: 1px solid rgba(0, 245, 212, 0.1);
          background: rgba(10, 15, 20, 0.8);
          backdrop-filter: blur(10px);
          position: sticky;
          top: 0;
          z-index: 100;
        }
        
        .logo {
          display: flex;
          align-items: center;
          gap: 15px;
        }
        
        .logo-icon {
          width: 50px;
          height: 50px;
          background: linear-gradient(135deg, #00f5d4 0%, #00b4d8 100%);
          border-radius: 12px;
          display: flex;
          align-items: center;
          justify-content: center;
          position: relative;
          overflow: hidden;
        }
        
        .logo-icon::before {
          content: '';
          position: absolute;
          width: 100%;
          height: 100%;
          background: linear-gradient(45deg, transparent 40%, rgba(255,255,255,0.3) 50%, transparent 60%);
          animation: shine 3s infinite;
        }
        
        @keyframes shine {
          0% { transform: translateX(-100%); }
          100% { transform: translateX(100%); }
        }
        
        .logo-icon svg {
          width: 30px;
          height: 30px;
          fill: #0a0f14;
        }
        
        .logo-text h1 {
          font-size: 24px;
          font-weight: 700;
          background: linear-gradient(90deg, #00f5d4, #00b4d8);
          -webkit-background-clip: text;
          -webkit-text-fill-color: transparent;
          letter-spacing: -0.5px;
        }
        
        .logo-text span {
          font-size: 11px;
          color: #6b7c93;
          letter-spacing: 2px;
          text-transform: uppercase;
        }
        
        .header-stats {
          display: flex;
          gap: 30px;
        }
        
        .stat-item {
          text-align: center;
        }
        
        .stat-value {
          font-family: 'JetBrains Mono', monospace;
          font-size: 22px;
          font-weight: 600;
          color: #00f5d4;
        }
        
        .stat-label {
          font-size: 10px;
          color: #6b7c93;
          text-transform: uppercase;
          letter-spacing: 1px;
        }
        
        /* Navigation Tabs */
        .nav-tabs {
          display: flex;
          gap: 5px;
          padding: 20px 40px;
          background: rgba(15, 20, 30, 0.5);
        }
        
        .tab {
          padding: 12px 24px;
          background: transparent;
          border: 1px solid #2a3a4a;
          border-radius: 8px;
          color: #6b7c93;
          font-family: 'Sora', sans-serif;
          font-size: 13px;
          font-weight: 500;
          cursor: pointer;
          transition: all 0.3s ease;
          display: flex;
          align-items: center;
          gap: 8px;
        }
        
        .tab:hover {
          border-color: #00f5d4;
          color: #00f5d4;
        }
        
        .tab.active {
          background: linear-gradient(135deg, rgba(0, 245, 212, 0.15) 0%, rgba(0, 180, 216, 0.1) 100%);
          border-color: #00f5d4;
          color: #00f5d4;
        }
        
        .tab-icon {
          width: 18px;
          height: 18px;
        }
        
        /* Main Content */
        .main-content {
          padding: 30px 40px;
          display: grid;
          grid-template-columns: 1fr 400px;
          gap: 30px;
        }
        
        /* Panels */
        .panel {
          background: linear-gradient(145deg, rgba(20, 25, 35, 0.9) 0%, rgba(15, 20, 30, 0.95) 100%);
          border: 1px solid rgba(42, 58, 74, 0.5);
          border-radius: 16px;
          padding: 24px;
          position: relative;
          overflow: hidden;
        }
        
        .panel::before {
          content: '';
          position: absolute;
          top: 0;
          left: 0;
          right: 0;
          height: 1px;
          background: linear-gradient(90deg, transparent, rgba(0, 245, 212, 0.3), transparent);
        }
        
        .panel-header {
          display: flex;
          justify-content: space-between;
          align-items: center;
          margin-bottom: 20px;
        }
        
        .panel-title {
          font-size: 14px;
          font-weight: 600;
          color: #8899aa;
          text-transform: uppercase;
          letter-spacing: 1.5px;
          display: flex;
          align-items: center;
          gap: 10px;
        }
        
        .panel-title::before {
          content: '';
          width: 4px;
          height: 16px;
          background: linear-gradient(180deg, #00f5d4, #00b4d8);
          border-radius: 2px;
        }
        
        /* Map Container */
        .map-container {
          position: relative;
          height: 400px;
          background: #0a0f14;
          border-radius: 12px;
          overflow: hidden;
        }
        
        .map-placeholder {
          width: 100%;
          height: 100%;
          background: 
            radial-gradient(circle at 30% 40%, rgba(0, 245, 212, 0.1) 0%, transparent 50%),
            radial-gradient(circle at 70% 60%, rgba(0, 180, 216, 0.1) 0%, transparent 50%),
            #0a0f14;
          display: flex;
          flex-direction: column;
          align-items: center;
          justify-content: center;
          color: #4a5568;
        }
        
        .crime-points {
          position: absolute;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
        }
        
        .crime-point {
          position: absolute;
          width: 16px;
          height: 16px;
          background: #ff6b6b;
          border: 2px solid #fff;
          border-radius: 50%;
          transform: translate(-50%, -50%);
          cursor: pointer;
          transition: all 0.3s ease;
          box-shadow: 0 0 10px rgba(255, 107, 107, 0.5);
        }
        
        .crime-point:hover, .crime-point.selected {
          transform: translate(-50%, -50%) scale(1.5);
          box-shadow: 0 0 20px rgba(255, 107, 107, 0.8);
        }
        
        .crime-point.selected::after {
          content: '';
          position: absolute;
          width: 40px;
          height: 40px;
          border: 2px solid #00f5d4;
          border-radius: 50%;
          top: 50%;
          left: 50%;
          transform: translate(-50%, -50%);
          animation: pulse-ring 1.5s infinite;
        }
        
        @keyframes pulse-ring {
          0% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
          100% { transform: translate(-50%, -50%) scale(2); opacity: 0; }
        }
        
        /* Scanning Overlay */
        .scanning-overlay {
          position: absolute;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
          display: flex;
          flex-direction: column;
          align-items: center;
          justify-content: center;
          background: rgba(0, 0, 0, 0.6);
          z-index: 10;
        }
        
        .scan-ring {
          position: absolute;
          width: 200px;
          height: 200px;
          border: 3px solid #00f5d4;
          border-radius: 50%;
          animation: scan-pulse 2s infinite;
        }
        
        .scan-ring.delay {
          animation-delay: 0.5s;
        }
        
        @keyframes scan-pulse {
          0% { opacity: 1; }
          100% { opacity: 0; }
        }
        
        .scan-text {
          font-family: 'JetBrains Mono', monospace;
          font-size: 14px;
          color: #00f5d4;
          margin-top: 150px;
          animation: blink 0.5s infinite;
        }
        
        @keyframes blink {
          50% { opacity: 0.5; }
        }
        
        /* Control Panel */
        .control-panel {
          display: flex;
          flex-direction: column;
          gap: 20px;
        }
        
        .input-group {
          display: flex;
          flex-direction: column;
          gap: 8px;
        }
        
        .input-label {
          font-size: 11px;
          color: #6b7c93;
          text-transform: uppercase;
          letter-spacing: 1px;
        }
        
        .input-field {
          padding: 12px 16px;
          background: rgba(10, 15, 20, 0.8);
          border: 1px solid #2a3a4a;
          border-radius: 8px;
          color: #e0e6ed;
          font-family: 'JetBrains Mono', monospace;
          font-size: 14px;
          transition: all 0.3s ease;
        }
        
        .input-field:focus {
          outline: none;
          border-color: #00f5d4;
          box-shadow: 0 0 0 3px rgba(0, 245, 212, 0.1);
        }
        
        .scan-button {
          padding: 16px 24px;
          background: linear-gradient(135deg, #00f5d4 0%, #00b4d8 100%);
          border: none;
          border-radius: 10px;
          color: #0a0f14;
          font-family: 'Sora', sans-serif;
          font-size: 14px;
          font-weight: 600;
          cursor: pointer;
          transition: all 0.3s ease;
          display: flex;
          align-items: center;
          justify-content: center;
          gap: 10px;
          text-transform: uppercase;
          letter-spacing: 1px;
        }
        
        .scan-button:hover {
          transform: translateY(-2px);
          box-shadow: 0 10px 30px rgba(0, 245, 212, 0.3);
        }
        
        .scan-button:disabled {
          opacity: 0.5;
          cursor: not-allowed;
          transform: none;
        }
        
        /* Results Panel */
        .results-panel {
          margin-top: 20px;
          animation: slideUp 0.5s ease;
        }
        
        @keyframes slideUp {
          from { opacity: 0; transform: translateY(20px); }
          to { opacity: 1; transform: translateY(0); }
        }
        
        .result-card {
          padding: 16px;
          background: rgba(0, 245, 212, 0.05);
          border: 1px solid rgba(0, 245, 212, 0.2);
          border-radius: 10px;
          margin-bottom: 12px;
          transition: all 0.3s ease;
        }
        
        .result-card:hover {
          background: rgba(0, 245, 212, 0.1);
          border-color: rgba(0, 245, 212, 0.4);
        }
        
        .result-header {
          display: flex;
          justify-content: space-between;
          align-items: center;
          margin-bottom: 8px;
        }
        
        .result-id {
          font-family: 'JetBrains Mono', monospace;
          font-size: 13px;
          color: #00f5d4;
        }
        
        .similarity-badge {
          padding: 4px 10px;
          background: linear-gradient(135deg, rgba(0, 245, 212, 0.2) 0%, rgba(0, 180, 216, 0.2) 100%);
          border-radius: 20px;
          font-size: 12px;
          font-weight: 600;
          color: #00f5d4;
        }
        
        .weight-bars {
          display: flex;
          gap: 15px;
          margin-top: 10px;
        }
        
        .weight-item {
          flex: 1;
        }
        
        .weight-label {
          font-size: 9px;
          color: #6b7c93;
          text-transform: uppercase;
          margin-bottom: 4px;
        }
        
        .weight-bar {
          height: 4px;
          background: #1a2530;
          border-radius: 2px;
          overflow: hidden;
        }
        
        .weight-fill {
          height: 100%;
          border-radius: 2px;
          transition: width 0.5s ease;
        }
        
        .weight-fill.spatial { background: #3498db; }
        .weight-fill.temporal { background: #f39c12; }
        .weight-fill.semantic { background: #9b59b6; }
        
        /* Insight Box */
        .insight-box {
          margin-top: 20px;
          padding: 16px;
          background: linear-gradient(135deg, rgba(243, 156, 18, 0.1) 0%, rgba(230, 126, 34, 0.05) 100%);
          border: 1px solid rgba(243, 156, 18, 0.3);
          border-radius: 10px;
        }
        
        .insight-title {
          font-size: 11px;
          color: #f39c12;
          text-transform: uppercase;
          letter-spacing: 1px;
          margin-bottom: 8px;
          display: flex;
          align-items: center;
          gap: 8px;
        }
        
        .insight-text {
          font-size: 13px;
          line-height: 1.6;
          color: #c4cdd5;
        }
        
        /* Network Graph Styles */
        .network-graph {
          width: 100%;
          height: 100%;
          background: #0a0f14;
          border-radius: 12px;
        }
        
        .pulse-ring {
          animation: node-pulse 1.5s infinite;
        }
        
        @keyframes node-pulse {
          0%, 100% { r: 18; opacity: 0.3; }
          50% { r: 25; opacity: 0.6; }
        }
        
        .node-highlighted {
          animation: node-glow 1s infinite alternate;
        }
        
        @keyframes node-glow {
          from { filter: url(#glow); }
          to { filter: url(#glow) brightness(1.2); }
        }
        
        .edge-animated {
          stroke-dasharray: 10, 5;
          animation: dash 1s linear infinite;
        }
        
        @keyframes dash {
          to { stroke-dashoffset: -15; }
        }
        
        /* Heatmap Tab Styles */
        .time-controls {
          display: flex;
          align-items: center;
          gap: 20px;
          margin-bottom: 20px;
        }
        
        .time-slider {
          flex: 1;
          -webkit-appearance: none;
          height: 6px;
          background: #1a2530;
          border-radius: 3px;
          outline: none;
        }
        
        .time-slider::-webkit-slider-thumb {
          -webkit-appearance: none;
          width: 20px;
          height: 20px;
          background: linear-gradient(135deg, #00f5d4, #00b4d8);
          border-radius: 50%;
          cursor: pointer;
          box-shadow: 0 0 10px rgba(0, 245, 212, 0.5);
        }
        
        .time-label {
          font-family: 'JetBrains Mono', monospace;
          font-size: 14px;
          color: #00f5d4;
          min-width: 100px;
        }
        
        .heatmap-svg {
          width: 100%;
          height: 300px;
          border-radius: 12px;
        }
        
        .hotspot-pulse {
          animation: hotspot-throb 2s ease-in-out infinite;
        }
        
        @keyframes hotspot-throb {
          0%, 100% { opacity: 0.7; }
          50% { opacity: 1; }
        }
        
        .arrow-animate {
          stroke-dasharray: 100;
          stroke-dashoffset: 100;
          animation: draw-arrow 1s ease forwards;
        }
        
        @keyframes draw-arrow {
          to { stroke-dashoffset: 0; }
        }
        
        .zone-blink {
          animation: zone-flash 1s infinite;
        }
        
        @keyframes zone-flash {
          50% { opacity: 0.3; }
        }
        
        .filter-pills {
          display: flex;
          gap: 10px;
          margin-bottom: 20px;
        }
        
        .pill {
          padding: 8px 16px;
          background: rgba(20, 25, 35, 0.8);
          border: 1px solid #2a3a4a;
          border-radius: 20px;
          color: #6b7c93;
          font-size: 12px;
          cursor: pointer;
          transition: all 0.3s ease;
        }
        
        .pill:hover, .pill.active {
          border-color: #00f5d4;
          color: #00f5d4;
          background: rgba(0, 245, 212, 0.1);
        }
        
        .prediction-box {
          margin-top: 20px;
          padding: 16px;
          background: linear-gradient(135deg, rgba(255, 0, 0, 0.1) 0%, rgba(255, 107, 0, 0.05) 100%);
          border: 1px solid rgba(255, 0, 0, 0.3);
          border-radius: 10px;
        }
        
        .prediction-title {
          font-size: 11px;
          color: #ff6b6b;
          text-transform: uppercase;
          letter-spacing: 1px;
          margin-bottom: 12px;
        }
        
        .zone-item {
          display: flex;
          justify-content: space-between;
          align-items: center;
          padding: 8px 0;
          border-bottom: 1px solid rgba(255, 107, 107, 0.1);
        }
        
        .zone-item:last-child {
          border-bottom: none;
        }
        
        .zone-name {
          font-size: 13px;
          color: #e0e6ed;
        }
        
        .zone-risk {
          padding: 4px 10px;
          background: rgba(255, 0, 0, 0.2);
          border-radius: 4px;
          font-size: 11px;
          font-weight: 600;
          color: #ff6b6b;
        }
        
        /* Profiling Tab */
        .cluster-selector {
          display: flex;
          gap: 10px;
          margin-bottom: 20px;
        }
        
        .cluster-btn {
          padding: 12px 20px;
          background: rgba(20, 25, 35, 0.8);
          border: 1px solid #2a3a4a;
          border-radius: 8px;
          color: #6b7c93;
          font-size: 13px;
          cursor: pointer;
          transition: all 0.3s ease;
        }
        
        .cluster-btn:hover, .cluster-btn.active {
          border-color: #9b59b6;
          color: #9b59b6;
          background: rgba(155, 89, 182, 0.1);
        }
        
        .radar-chart {
          width: 100%;
          max-width: 300px;
          margin: 0 auto;
        }
        
        .legend {
          display: flex;
          justify-content: center;
          gap: 30px;
          margin-top: 20px;
        }
        
        .legend-item {
          display: flex;
          align-items: center;
          gap: 8px;
          font-size: 12px;
          color: #8899aa;
        }
        
        .legend-dot {
          width: 12px;
          height: 12px;
          border-radius: 50%;
        }
        
        .legend-dot.city { background: #3498db; }
        .legend-dot.group { background: #00f5d4; }
        
        .explanation-panel {
          margin-top: 20px;
          padding: 20px;
          background: linear-gradient(135deg, rgba(155, 89, 182, 0.1) 0%, rgba(142, 68, 173, 0.05) 100%);
          border: 1px solid rgba(155, 89, 182, 0.3);
          border-radius: 10px;
          animation: fadeIn 0.5s ease;
        }
        
        @keyframes fadeIn {
          from { opacity: 0; }
          to { opacity: 1; }
        }
        
        .explanation-header {
          display: flex;
          align-items: center;
          gap: 10px;
          margin-bottom: 15px;
        }
        
        .explanation-icon {
          width: 24px;
          height: 24px;
          background: rgba(155, 89, 182, 0.3);
          border-radius: 6px;
          display: flex;
          align-items: center;
          justify-content: center;
        }
        
        .explanation-title {
          font-size: 13px;
          font-weight: 600;
          color: #9b59b6;
        }
        
        .attention-weights {
          display: flex;
          gap: 20px;
          margin-top: 15px;
        }
        
        .attention-item {
          flex: 1;
          text-align: center;
        }
        
        .attention-circle {
          width: 80px;
          height: 80px;
          margin: 0 auto 10px;
          position: relative;
        }
        
        .attention-circle svg {
          transform: rotate(-90deg);
        }
        
        .attention-bg {
          fill: none;
          stroke: #1a2530;
          stroke-width: 8;
        }
        
        .attention-fill {
          fill: none;
          stroke-width: 8;
          stroke-linecap: round;
          transition: stroke-dashoffset 1s ease;
        }
        
        .attention-fill.temporal { stroke: #f39c12; }
        .attention-fill.spatial { stroke: #3498db; }
        
        .attention-value {
          position: absolute;
          top: 50%;
          left: 50%;
          transform: translate(-50%, -50%);
          font-family: 'JetBrains Mono', monospace;
          font-size: 18px;
          font-weight: 600;
          color: #e0e6ed;
        }
        
        .attention-label {
          font-size: 11px;
          color: #6b7c93;
          text-transform: uppercase;
        }
        
        /* Footer */
        .footer {
          padding: 20px 40px;
          text-align: center;
          border-top: 1px solid rgba(42, 58, 74, 0.3);
          color: #4a5568;
          font-size: 12px;
        }
        
        /* Responsive */
        @media (max-width: 1200px) {
          .main-content {
            grid-template-columns: 1fr;
          }
        }
      `}</style>

      {/* Header */}
      <header className="header">
        <div className="logo">
          <div className="logo-icon">
            <svg viewBox="0 0 24 24">
              <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z" />
            </svg>
          </div>
          <div className="logo-text">
            <h1>CrimeLink-GNN</h1>
            <span>Urban Crime Network Analysis</span>
          </div>
        </div>
        <div className="header-stats">
          <div className="stat-item">
            <div className="stat-value">30,000</div>
            <div className="stat-label">Total Nodes</div>
          </div>
          <div className="stat-item">
            <div className="stat-value">976K</div>
            <div className="stat-label">Edges</div>
          </div>
          <div className="stat-item">
            <div className="stat-value">92.4%</div>
            <div className="stat-label">AUC Score</div>
          </div>
        </div>
      </header>

      {/* Navigation */}
      <nav className="nav-tabs">
        <button
          className={`tab ${activeTab === "investigate" ? "active" : ""}`}
          onClick={() => setActiveTab("investigate")}
        >
          <svg className="tab-icon" viewBox="0 0 24 24" fill="currentColor">
            <path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z" />
          </svg>
          Truy vết Mạng lưới Ẩn
        </button>
        <button
          className={`tab ${activeTab === "forecast" ? "active" : ""}`}
          onClick={() => setActiveTab("forecast")}
        >
          <svg className="tab-icon" viewBox="0 0 24 24" fill="currentColor">
            <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z" />
          </svg>
          Dự báo Điểm nóng
        </button>
        <button
          className={`tab ${activeTab === "profile" ? "active" : ""}`}
          onClick={() => setActiveTab("profile")}
        >
          <svg className="tab-icon" viewBox="0 0 24 24" fill="currentColor">
            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 3c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3zm0 14.2c-2.5 0-4.71-1.28-6-3.22.03-1.99 4-3.08 6-3.08 1.99 0 5.97 1.09 6 3.08-1.29 1.94-3.5 3.22-6 3.22z" />
          </svg>
          Phân tích Hồ sơ
        </button>
      </nav>

      {/* Main Content */}
      <main className="main-content">
        {/* Tab 1: Investigation */}
        {activeTab === "investigate" && (
          <>
            <div className="panel">
              <div className="panel-header">
                <h2 className="panel-title">Mạng lưới Tội phạm Chicago</h2>
              </div>
              <div className="map-container">
                <NetworkGraph
                  nodes={graphNodes}
                  edges={graphEdges}
                  highlightedNodes={highlightedNodes}
                  onNodeClick={(node) => {
                    const crime = mockCrimes.find((c) => c.id === node.id);
                    setSelectedCrime(crime);
                    setHighlightedNodes([node.id]);
                    setShowResults(false);
                  }}
                />
                <ScanningOverlay
                  isScanning={isScanning}
                  progress={scanProgress}
                />
              </div>
            </div>

            <div className="control-panel">
              <div className="panel">
                <div className="panel-header">
                  <h2 className="panel-title">Bảng điều khiển</h2>
                </div>
                <div className="input-group">
                  <label className="input-label">Mã vụ án</label>
                  <input
                    type="text"
                    className="input-field"
                    value={selectedCrime?.id || ""}
                    placeholder="Click node hoặc nhập mã..."
                    onChange={(e) => {
                      const crime = mockCrimes.find(
                        (c) => c.id === e.target.value
                      );
                      if (crime) setSelectedCrime(crime);
                    }}
                  />
                </div>
                {selectedCrime && (
                  <div
                    style={{
                      marginTop: "15px",
                      padding: "12px",
                      background: "rgba(0,245,212,0.05)",
                      borderRadius: "8px",
                    }}
                  >
                    <div
                      style={{
                        fontSize: "12px",
                        color: "#6b7c93",
                        marginBottom: "5px",
                      }}
                    >
                      ĐÃ CHỌN
                    </div>
                    <div
                      style={{ fontFamily: "JetBrains Mono", color: "#00f5d4" }}
                    >
                      {selectedCrime.type}
                    </div>
                    <div
                      style={{
                        fontSize: "12px",
                        color: "#8899aa",
                        marginTop: "5px",
                      }}
                    >
                      Quận {selectedCrime.district} • {selectedCrime.date}{" "}
                      {selectedCrime.time}
                    </div>
                  </div>
                )}
                <button
                  className="scan-button"
                  style={{ marginTop: "20px", width: "100%" }}
                  onClick={handleScan}
                  disabled={!selectedCrime || isScanning}
                >
                  <svg
                    width="20"
                    height="20"
                    viewBox="0 0 24 24"
                    fill="currentColor"
                  >
                    <path d="M12 4V1L8 5l4 4V6c3.31 0 6 2.69 6 6 0 1.01-.25 1.97-.7 2.8l1.46 1.46C19.54 15.03 20 13.57 20 12c0-4.42-3.58-8-8-8zm0 14c-3.31 0-6-2.69-6-6 0-1.01.25-1.97.7-2.8L5.24 7.74C4.46 8.97 4 10.43 4 12c0 4.42 3.58 8 8 8v3l4-4-4-4v3z" />
                  </svg>
                  {isScanning ? "Đang quét..." : "Quét Liên Kết"}
                </button>
              </div>

              {showResults && (
                <div className="panel results-panel">
                  <div className="panel-header">
                    <h2 className="panel-title">Kết quả phân tích</h2>
                  </div>
                  {relatedCrimes.map((crime, i) => (
                    <div key={crime.id} className="result-card">
                      <div className="result-header">
                        <span className="result-id">{crime.id}</span>
                        <span className="similarity-badge">
                          {(crime.similarity * 100).toFixed(0)}% Match
                        </span>
                      </div>
                      <div className="weight-bars">
                        <div className="weight-item">
                          <div className="weight-label">Spatial</div>
                          <div className="weight-bar">
                            <div
                              className="weight-fill spatial"
                              style={{ width: `${crime.spatialWeight * 100}%` }}
                            ></div>
                          </div>
                        </div>
                        <div className="weight-item">
                          <div className="weight-label">Temporal</div>
                          <div className="weight-bar">
                            <div
                              className="weight-fill temporal"
                              style={{
                                width: `${crime.temporalWeight * 100}%`,
                              }}
                            ></div>
                          </div>
                        </div>
                        <div className="weight-item">
                          <div className="weight-label">Semantic</div>
                          <div className="weight-bar">
                            <div
                              className="weight-fill semantic"
                              style={{
                                width: `${crime.semanticWeight * 100}%`,
                              }}
                            ></div>
                          </div>
                        </div>
                      </div>
                    </div>
                  ))}
                  <div className="insight-box">
                    <div className="insight-title">
                      <svg
                        width="16"
                        height="16"
                        viewBox="0 0 24 24"
                        fill="currentColor"
                      >
                        <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z" />
                      </svg>
                      Phát hiện quan trọng
                    </div>
                    <p className="insight-text">
                      Dù các vụ án này cách nhau vài ngày và khác địa điểm, mô
                      hình GNN phát hiện ra{" "}
                      <strong style={{ color: "#00f5d4" }}>
                        mẫu hình di chuyển tương đồng
                      </strong>
                      . Đây là dấu hiệu của một{" "}
                      <strong style={{ color: "#f39c12" }}>
                        nhóm tội phạm lưu động
                      </strong>{" "}
                      hoạt động xuyên quận.
                    </p>
                  </div>
                </div>
              )}
            </div>
          </>
        )}

        {/* Tab 2: Hotspot Forecasting */}
        {activeTab === "forecast" && (
          <>
            <div className="panel">
              <div className="panel-header">
                <h2 className="panel-title">Dự báo Điểm nóng Động</h2>
              </div>
              <div className="filter-pills">
                <button
                  className={`pill ${timeFilter === "weekend" ? "active" : ""}`}
                  onClick={() => {
                    setTimeFilter("weekend");
                    setForecastComplete(false);
                  }}
                >
                  Cuối tuần
                </button>
                <button
                  className={`pill ${timeFilter === "weekday" ? "active" : ""}`}
                  onClick={() => {
                    setTimeFilter("weekday");
                    setForecastComplete(false);
                  }}
                >
                  Ngày thường
                </button>
                <button
                  className={`pill ${timeFilter === "night" ? "active" : ""}`}
                  onClick={() => {
                    setTimeFilter("night");
                    setForecastComplete(false);
                  }}
                >
                  Đêm khuya
                </button>
              </div>
              <div className="filter-pills">
                <button
                  className={`pill ${
                    crimeTypeFilter === "all" ? "active" : ""
                  }`}
                  onClick={() => {
                    setCrimeTypeFilter("all");
                    setForecastComplete(false);
                  }}
                >
                  Tất cả
                </button>
                <button
                  className={`pill ${
                    crimeTypeFilter === "narcotics" ? "active" : ""
                  }`}
                  onClick={() => {
                    setCrimeTypeFilter("narcotics");
                    setForecastComplete(false);
                  }}
                >
                  Ma túy
                </button>
                <button
                  className={`pill ${
                    crimeTypeFilter === "theft" ? "active" : ""
                  }`}
                  onClick={() => {
                    setCrimeTypeFilter("theft");
                    setForecastComplete(false);
                  }}
                >
                  Trộm cắp
                </button>
                <button
                  className={`pill ${
                    crimeTypeFilter === "violence" ? "active" : ""
                  }`}
                  onClick={() => {
                    setCrimeTypeFilter("violence");
                    setForecastComplete(false);
                  }}
                >
                  Bạo lực
                </button>
              </div>
              <div className="time-controls">
                <span style={{ fontSize: "12px", color: "#6b7c93" }}>
                  Thời gian:
                </span>
                <input
                  type="range"
                  className="time-slider"
                  min="0"
                  max="5"
                  step="1"
                  value={timeSlider}
                  onChange={(e) => {
                    setTimeSlider(parseInt(e.target.value));
                    if (parseInt(e.target.value) >= 3) {
                      setForecastComplete(true);
                    }
                  }}
                />
                <span className="time-label">
                  {timeFilter === "weekend" &&
                    [
                      "T7 00:00",
                      "T7 06:00",
                      "T7 12:00",
                      "T7 18:00",
                      "CN 00:00",
                      "CN 06:00",
                    ][timeSlider]}
                  {timeFilter === "weekday" &&
                    [
                      "T2 06:00",
                      "T2 12:00",
                      "T2 18:00",
                      "T3 06:00",
                      "T3 12:00",
                      "T3 18:00",
                    ][timeSlider]}
                  {timeFilter === "night" &&
                    ["22:00", "23:00", "00:00", "01:00", "02:00", "03:00"][
                      timeSlider
                    ]}
                </span>
              </div>
              <HeatmapVisualization
                timeStep={timeSlider}
                timeFilter={timeFilter}
                crimeType={crimeTypeFilter}
              />
            </div>

            <div className="control-panel">
              <div className="panel">
                <div className="panel-header">
                  <h2 className="panel-title">Cấu hình Dự báo</h2>
                </div>
                <div
                  style={{
                    padding: "15px",
                    background: "rgba(0,245,212,0.05)",
                    borderRadius: "8px",
                    marginBottom: "15px",
                  }}
                >
                  <div
                    style={{
                      fontSize: "11px",
                      color: "#6b7c93",
                      marginBottom: "8px",
                      textTransform: "uppercase",
                    }}
                  >
                    Đang phân tích
                  </div>
                  <div
                    style={{
                      fontFamily: "JetBrains Mono",
                      color: "#00f5d4",
                      fontSize: "14px",
                    }}
                  >
                    {timeFilter === "weekend" && "Cuối tuần"}
                    {timeFilter === "weekday" && "Ngày thường"}
                    {timeFilter === "night" && "Đêm khuya (22h-4h)"}
                  </div>
                  <div
                    style={{
                      fontSize: "12px",
                      color: "#8899aa",
                      marginTop: "5px",
                    }}
                  >
                    Loại: {crimeTypeFilter === "all" && "Tất cả tội phạm"}
                    {crimeTypeFilter === "narcotics" && "Tội phạm Ma túy"}
                    {crimeTypeFilter === "theft" && "Trộm cắp tài sản"}
                    {crimeTypeFilter === "violence" && "Bạo lực"}
                  </div>
                </div>

                <button
                  className="scan-button"
                  style={{ width: "100%", marginBottom: "15px" }}
                  onClick={() => {
                    setIsForecasting(true);
                    setForecastComplete(false);
                    let step = 0;
                    const interval = setInterval(() => {
                      step++;
                      setTimeSlider(step);
                      if (step >= 5) {
                        clearInterval(interval);
                        setIsForecasting(false);
                        setForecastComplete(true);
                      }
                    }, 500);
                  }}
                  disabled={isForecasting}
                >
                  <svg
                    width="20"
                    height="20"
                    viewBox="0 0 24 24"
                    fill="currentColor"
                  >
                    <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z" />
                  </svg>
                  {isForecasting ? "Đang dự báo..." : "Chạy Dự báo"}
                </button>

                {forecastComplete && (
                  <div
                    className="prediction-box"
                    style={{ animation: "slideUp 0.5s ease" }}
                  >
                    <div className="prediction-title">
                      ⚠️ Vùng nguy cơ cao được phát hiện
                    </div>
                    {crimeTypeFilter === "narcotics" && (
                      <>
                        <div className="zone-item">
                          <span className="zone-name">Khu vực A - Quận 11</span>
                          <span className="zone-risk">
                            {timeFilter === "night" ? "94%" : "87%"} Risk
                          </span>
                        </div>
                        <div className="zone-item">
                          <span className="zone-name">Khu vực B - Quận 7</span>
                          <span className="zone-risk">
                            {timeFilter === "night" ? "89%" : "79%"} Risk
                          </span>
                        </div>
                      </>
                    )}
                    {crimeTypeFilter === "theft" && (
                      <>
                        <div className="zone-item">
                          <span className="zone-name">
                            Trung tâm TM - Quận 1
                          </span>
                          <span className="zone-risk">
                            {timeFilter === "weekday" ? "91%" : "76%"} Risk
                          </span>
                        </div>
                        <div className="zone-item">
                          <span className="zone-name">Bãi đỗ xe - Quận 5</span>
                          <span className="zone-risk">
                            {timeFilter === "night" ? "88%" : "72%"} Risk
                          </span>
                        </div>
                      </>
                    )}
                    {crimeTypeFilter === "violence" && (
                      <>
                        <div className="zone-item">
                          <span className="zone-name">
                            Khu giải trí - Quận 3
                          </span>
                          <span className="zone-risk">
                            {timeFilter === "night" ? "96%" : "82%"} Risk
                          </span>
                        </div>
                        <div className="zone-item">
                          <span className="zone-name">Khu dân cư - Quận 9</span>
                          <span className="zone-risk">74% Risk</span>
                        </div>
                      </>
                    )}
                    {crimeTypeFilter === "all" && (
                      <>
                        <div className="zone-item">
                          <span className="zone-name">
                            Đa điểm - Quận 7, 11
                          </span>
                          <span className="zone-risk">85% Risk</span>
                        </div>
                        <div className="zone-item">
                          <span className="zone-name">Khu vực C - Quận 3</span>
                          <span className="zone-risk">78% Risk</span>
                        </div>
                      </>
                    )}
                  </div>
                )}

                {forecastComplete && (
                  <div
                    className="insight-box"
                    style={{
                      marginTop: "20px",
                      animation: "slideUp 0.5s ease",
                    }}
                  >
                    <div className="insight-title">
                      <svg
                        width="16"
                        height="16"
                        viewBox="0 0 24 24"
                        fill="currentColor"
                      >
                        <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z" />
                      </svg>
                      Đề xuất Tuần tra
                    </div>
                    <p className="insight-text">
                      {timeFilter === "weekend" &&
                        crimeTypeFilter === "narcotics" && (
                          <>
                            Hệ thống đề xuất{" "}
                            <strong style={{ color: "#00f5d4" }}>
                              lộ trình tuần tra tối ưu
                            </strong>{" "}
                            cắt ngang luồng di chuyển dự báo. Triển khai từ{" "}
                            <strong style={{ color: "#f39c12" }}>
                              22:00 - 04:00
                            </strong>{" "}
                            sẽ đạt hiệu quả cao nhất.
                          </>
                        )}
                      {timeFilter === "weekday" && (
                        <>
                          Ngày thường có mật độ thấp hơn. Tập trung{" "}
                          <strong style={{ color: "#00f5d4" }}>
                            tuần tra cơ động
                          </strong>{" "}
                          vào khung{" "}
                          <strong style={{ color: "#f39c12" }}>
                            17:00 - 21:00
                          </strong>{" "}
                          khi người dân tan làm.
                        </>
                      )}
                      {timeFilter === "night" && (
                        <>
                          Khung đêm khuya có{" "}
                          <strong style={{ color: "#ff6b6b" }}>
                            nguy cơ cao nhất
                          </strong>
                          . Đề xuất{" "}
                          <strong style={{ color: "#00f5d4" }}>
                            tăng cường 50% lực lượng
                          </strong>{" "}
                          và sử dụng{" "}
                          <strong style={{ color: "#f39c12" }}>
                            camera giám sát AI
                          </strong>
                          .
                        </>
                      )}
                      {timeFilter === "weekend" &&
                        crimeTypeFilter !== "narcotics" && (
                          <>
                            Cuối tuần tập trung tại các điểm đông người.{" "}
                            <strong style={{ color: "#00f5d4" }}>
                              Tuần tra đồng phục
                            </strong>{" "}
                            kết hợp{" "}
                            <strong style={{ color: "#f39c12" }}>
                              thường phục
                            </strong>{" "}
                            sẽ hiệu quả.
                          </>
                        )}
                    </p>
                  </div>
                )}
              </div>
            </div>
          </>
        )}

        {/* Tab 3: Deep Profiling */}
        {activeTab === "profile" && (
          <>
            <div className="panel">
              <div className="panel-header">
                <h2 className="panel-title">Phân tích Hồ sơ Đối tượng</h2>
              </div>
              <div className="cluster-selector">
                <button
                  className={`cluster-btn ${
                    selectedCluster === "A" ? "active" : ""
                  }`}
                  onClick={() => {
                    setSelectedCluster("A");
                    setShowExplanation(true);
                  }}
                >
                  Cluster A - Trộm xe
                </button>
                <button
                  className={`cluster-btn ${
                    selectedCluster === "B" ? "active" : ""
                  }`}
                  onClick={() => {
                    setSelectedCluster("B");
                    setShowExplanation(true);
                  }}
                >
                  Cluster B - Ma túy
                </button>
                <button
                  className={`cluster-btn ${
                    selectedCluster === "C" ? "active" : ""
                  }`}
                  onClick={() => {
                    setSelectedCluster("C");
                    setShowExplanation(true);
                  }}
                >
                  Cluster C - Đột nhập
                </button>
              </div>

              {selectedCluster && currentRadarData && (
                <>
                  <RadarChart data={currentRadarData} labels={radarLabels} />
                  <div className="legend">
                    <div className="legend-item">
                      <div className="legend-dot city"></div>
                      <span>Trung bình Chicago</span>
                    </div>
                    <div className="legend-item">
                      <div className="legend-dot group"></div>
                      <span>
                        Cluster {selectedCluster} - {currentRadarData.name}
                      </span>
                    </div>
                  </div>
                </>
              )}

              {!selectedCluster && (
                <div
                  style={{
                    textAlign: "center",
                    padding: "60px 20px",
                    color: "#6b7c93",
                  }}
                >
                  <svg
                    width="60"
                    height="60"
                    viewBox="0 0 24 24"
                    fill="currentColor"
                    style={{ opacity: 0.3, marginBottom: "15px" }}
                  >
                    <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 3c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3zm0 14.2c-2.5 0-4.71-1.28-6-3.22.03-1.99 4-3.08 6-3.08 1.99 0 5.97 1.09 6 3.08-1.29 1.94-3.5 3.22-6 3.22z" />
                  </svg>
                  <p>Chọn một Cluster để xem phân tích chi tiết</p>
                </div>
              )}
            </div>

            <div className="control-panel">
              {showExplanation && currentRadarData && (
                <div className="panel">
                  <div className="panel-header">
                    <h2 className="panel-title">
                      Chi tiết Cluster {selectedCluster}
                    </h2>
                  </div>

                  <div
                    style={{
                      padding: "15px",
                      background: "rgba(155,89,182,0.1)",
                      borderRadius: "8px",
                      marginBottom: "15px",
                    }}
                  >
                    <div
                      style={{
                        fontSize: "11px",
                        color: "#9b59b6",
                        marginBottom: "8px",
                        textTransform: "uppercase",
                      }}
                    >
                      Loại tội phạm
                    </div>
                    <div
                      style={{
                        fontFamily: "JetBrains Mono",
                        color: "#e0e6ed",
                        fontSize: "16px",
                      }}
                    >
                      {currentRadarData.name}
                    </div>
                    <div
                      style={{
                        fontSize: "12px",
                        color: "#8899aa",
                        marginTop: "8px",
                      }}
                    >
                      Thời điểm hoạt động:{" "}
                      <strong style={{ color: "#f39c12" }}>
                        {currentRadarData.peakTime}
                      </strong>
                    </div>
                    <div
                      style={{
                        fontSize: "12px",
                        color: "#8899aa",
                        marginTop: "4px",
                      }}
                    >
                      Địa điểm:{" "}
                      <strong style={{ color: "#00f5d4" }}>
                        {currentRadarData.location}
                      </strong>
                    </div>
                  </div>

                  <div className="explanation-panel">
                    <div className="explanation-header">
                      <div className="explanation-icon">
                        <svg
                          width="14"
                          height="14"
                          viewBox="0 0 24 24"
                          fill="#9b59b6"
                        >
                          <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z" />
                        </svg>
                      </div>
                      <span className="explanation-title">
                        Explainable AI - Multi-head Attention
                      </span>
                    </div>
                    <p
                      style={{
                        fontSize: "13px",
                        color: "#c4cdd5",
                        lineHeight: "1.6",
                      }}
                    >
                      Liên kết trong cluster này được hình thành chủ yếu do yếu
                      tố <strong style={{ color: "#f39c12" }}>Thời gian</strong>{" "}
                      ({(currentRadarData.temporalWeight * 100).toFixed(0)}%)
                      {currentRadarData.temporalWeight >
                      currentRadarData.spatialWeight
                        ? " chiếm ưu thế hơn "
                        : " cân bằng với "}
                      <strong style={{ color: "#3498db" }}>Khoảng cách</strong>{" "}
                      ({(currentRadarData.spatialWeight * 100).toFixed(0)}%).
                    </p>
                    <div className="attention-weights">
                      <div className="attention-item">
                        <div className="attention-circle">
                          <svg viewBox="0 0 36 36" width="80" height="80">
                            <circle
                              className="attention-bg"
                              cx="18"
                              cy="18"
                              r="15.915"
                            />
                            <circle
                              className="attention-fill temporal"
                              cx="18"
                              cy="18"
                              r="15.915"
                              strokeDasharray={`${
                                currentRadarData.temporalWeight * 100
                              } 100`}
                            />
                          </svg>
                          <span className="attention-value">
                            {currentRadarData.temporalWeight}
                          </span>
                        </div>
                        <div className="attention-label">Temporal Weight</div>
                      </div>
                      <div className="attention-item">
                        <div className="attention-circle">
                          <svg viewBox="0 0 36 36" width="80" height="80">
                            <circle
                              className="attention-bg"
                              cx="18"
                              cy="18"
                              r="15.915"
                            />
                            <circle
                              className="attention-fill spatial"
                              cx="18"
                              cy="18"
                              r="15.915"
                              strokeDasharray={`${
                                currentRadarData.spatialWeight * 100
                              } 100`}
                            />
                          </svg>
                          <span className="attention-value">
                            {currentRadarData.spatialWeight}
                          </span>
                        </div>
                        <div className="attention-label">Spatial Weight</div>
                      </div>
                    </div>
                  </div>

                  <div className="insight-box" style={{ marginTop: "20px" }}>
                    <div className="insight-title">
                      <svg
                        width="16"
                        height="16"
                        viewBox="0 0 24 24"
                        fill="currentColor"
                      >
                        <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z" />
                      </svg>
                      Phân tích Chuyên sâu
                    </div>
                    <p className="insight-text">{currentRadarData.insight}</p>
                  </div>
                </div>
              )}

              {!showExplanation && (
                <div className="panel">
                  <div
                    style={{
                      textAlign: "center",
                      padding: "40px 20px",
                      color: "#6b7c93",
                    }}
                  >
                    <p>Chọn cluster để xem phân tích Explainable AI</p>
                  </div>
                </div>
              )}
            </div>
          </>
        )}
      </main>

      {/* Footer */}
      <footer className="footer">
        <p>CrimeLink-GNN © 2025 | Data For Life Competition | Team TT2-V06</p>
        <p style={{ marginTop: "5px" }}>
          Powered by GraphSAGE with Multi-head Attention | Chicago Crime Dataset
          (2015-2023)
        </p>
      </footer>
    </div>
  );
}
